<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cyber-Glass Elite Player V2</title>
  <style>
    @import url('https://fonts.googleapis.com');

    :root { 
      --accent: #00f2ff; 
      --neon-p: #ff00ff;
      --bass: 0; 
    }
    
    body { 
      margin: 0; height: 100vh; display: flex; justify-content: center; align-items: center; 
      background: #000; overflow: hidden; font-family: 'Rajdhani', sans-serif; color: #fff; 
    }

    /* --- ANIMATION ENGINE --- */
    .fx-canvas { 
      position: absolute; inset: 0; z-index: -1; 
      transform: scale(calc(1 + (var(--bass) * 0.05))); 
      filter: brightness(calc(0.8 + var(--bass) * 0.4)); 
      pointer-events: none;
    }
    .layer { position: absolute; inset: 0; display: none; overflow: hidden; }

    /* FIXED: Neural Glitch */
    #glitch { 
      background: repeating-linear-gradient(0deg, rgba(255,255,255,0.05) 0px, transparent 2px); 
      animation: shake 0.1s infinite;
      box-shadow: inset 0 0 100px rgba(0,242,255,0.2);
    }
    @keyframes shake { 
      0% { transform: translate(0,0) skew(0deg); filter: hue-rotate(0deg); }
      33% { transform: translate(5px, -2px) skew(5deg); filter: hue-rotate(90deg); }
      66% { transform: translate(-5px, 2px) skew(-5deg); filter: hue-rotate(180deg); }
      100% { transform: translate(0,0) skew(0deg); filter: hue-rotate(360deg); }
    }

    /* 1. CHRONO-GRID */
    #grid {
      background: linear-gradient(transparent 0%, var(--accent) 1%, transparent 2%), linear-gradient(90deg, transparent 0%, var(--accent) 1%, transparent 2%);
      background-size: 60px 60px; width: 400vw; height: 400vh; top: -100vh; left: -150vw;
      transform: perspective(400px) rotateX(60deg); animation: drive 2s linear infinite; opacity: 0.3;
    }
    @keyframes drive { from { background-position: 0 0; } to { background-position: 0 60px; } }

    /* FIXED: Sakura Drift */
    .petal { position: absolute; font-size: 28px; animation: sakuraMove linear forwards; filter: drop-shadow(0 0 10px #ffb7c5); color: #ffb7c5; }
    @keyframes sakuraMove { 
      0% { transform: translateY(-10vh) rotate(0deg); opacity: 0; }
      10% { opacity: 1; }
      100% { transform: translateY(110vh) translateX(100px) rotate(720deg); opacity: 0; }
    }

    /* 3. DOMAIN EXPANSION */
    #void { background: radial-gradient(circle at center, #1a0033 0%, #000 70%); }
    .void-ring { position: absolute; border: 2px solid #5500ff; border-radius: 50%; top: 50%; left: 50%; transform: translate(-50%, -50%); animation: ringExp 3s infinite linear; }
    @keyframes ringExp { from { width: 0; height: 0; opacity: 1; } to { width: 150vw; height: 150vw; opacity: 0; } }

    /* FX Support Classes */
    .rain-trail { position: absolute; width: 2px; height: 150px; background: linear-gradient(transparent, var(--accent)); animation: fall 1s linear forwards; }
    #nebula { background: linear-gradient(45deg, #7000ff, #00f2ff, #ff0070); filter: blur(100px); opacity: 0.2; transform: scale(2); }
    .hex { position: absolute; border: 2px solid var(--accent); background: rgba(0,242,255,0.1); clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); animation: floatUp 8s linear forwards; }
    .lightning { position: absolute; background: #fff; box-shadow: 0 0 30px #fff, 0 0 50px var(--accent); animation: flash 0.15s linear; }
    .dust { position: absolute; background: #fff; border-radius: 50%; box-shadow: 0 0 10px #fff; animation: fall 3s linear forwards; }
    .bubble { position: absolute; border: 1px solid rgba(255,255,255,0.5); border-radius: 50%; animation: rise 4s ease-in forwards; }
    .firefly { position: absolute; width: 6px; height: 6px; background: #ffea00; border-radius: 50%; filter: blur(2px); box-shadow: 0 0 15px #ffea00; animation: wander 4s infinite alternate; }
    .bin { position: absolute; color: #0f0; font-family: monospace; text-shadow: 0 0 5px #0f0; animation: fall 2s linear forwards; }
    .flame { position: absolute; bottom: 0; width: 60px; height: 200px; background: linear-gradient(0deg, orange, #ff0000, transparent); filter: blur(20px); animation: rise 1s linear forwards; opacity: 0.6; }

    @keyframes fall { to { transform: translateY(110vh); } }
    @keyframes rise { to { transform: translateY(-110vh); } }
    @keyframes floatUp { from { transform: translateY(110vh) rotate(0deg); } to { transform: translateY(-20vh) rotate(360deg); } }
    @keyframes flash { from { opacity: 1; height: 100vh; width: 2px; } to { opacity: 0; height: 100vh; width: 15px; } }
    @keyframes wander { from { transform: translate(0, 0); } to { transform: translate(100px, -100px); } }

    /* --- PLAYER UI --- */
    .player-wrap { 
      width: 85vw; max-width: 1000px; aspect-ratio: 16/9; 
      background: #000; border-radius: 24px; overflow: hidden; 
      border: 2px solid rgba(0, 242, 255, 0.3); 
      box-shadow: 0 0 40px #000, 0 0 calc(var(--bass) * 50px) var(--accent);
      z-index: 10; display: flex; flex-direction: column;
    }
    video { flex: 1; width: 100%; height: 100%; object-fit: contain; }
    .controls { 
      display: flex; padding: 20px; 
      background: rgba(0, 0, 0, 0.85); backdrop-filter: blur(20px); 
      gap: 15px; align-items: center; justify-content: center;
    }
    button { 
      background: transparent; border: 2px solid var(--accent); color: var(--accent); 
      padding: 12px 28px; border-radius: 50px; cursor: pointer; 
      font-family: 'Orbitron', sans-serif; font-size: 11px; letter-spacing: 2px;
      transition: all 0.3s;
    }
    button:hover { background: var(--accent); color: #000; box-shadow: 0 0 20px var(--accent); transform: scale(1.05); }
    select { 
      background: #111; border: 2px solid rgba(255,255,255,0.2); color: #fff; 
      padding: 12px; border-radius: 12px; font-family: 'Rajdhani', sans-serif;
      min-width: 200px; cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="fx-canvas" id="canvas">
    <div class="layer" id="grid"></div>
    <div class="layer" id="sakura"></div>
    <div class="layer" id="void"></div>
    <div class="layer" id="rain"></div>
    <div class="layer" id="nebula"></div>
    <div class="layer" id="hex"></div>
    <div class="layer" id="storm"></div>
    <div class="layer" id="stars"></div>
    <div class="layer" id="sea"></div>
    <div class="layer" id="flies"></div>
    <div class="layer" id="glitch"></div>
    <div class="layer" id="binary"></div>
    <div class="layer" id="aura"></div>
  </div>

  <div class="player-wrap">
    <video id="v" src="https://www.w3schools.com" crossorigin="anonymous" loop></video>
    <div class="controls">
      <button onclick="startAudio(); v.paused ? v.play() : v.pause()">â—ˆ PLAY / PAUSE</button>
      <button onclick="v.requestFullscreen()">â›¶ FULLSCREEN</button>
      <select id="fxPicker" onchange="setFX(this.value)">
        <option value="">Visualizer Off</option>
        <option value="grid">Chrono-Grid 3D</option>
        <option value="sakura">Sakura Blossom Drift</option>
        <option value="void">Domain Expansion</option>
        <option value="rain">Cyber-Rain Trails</option>
        <option value="nebula">Prismatic Plasma</option>
        <option value="hex">Quantum Hex-Field</option>
        <option value="storm">Thunderbolt Storm</option>
        <option value="stars">Stardust Cascade</option>
        <option value="sea">Abyssal Bubbles</option>
        <option value="flies">Firefly Sanctuary</option>
        <option value="glitch">Neural Glitch</option>
        <option value="binary">Data Stream: Binary</option>
        <option value="aura">God Mode: Aura</option>
      </select>
    </div>
  </div>

  <script>
    const v = document.getElementById('v');
    const layers = document.querySelectorAll('.layer');
    let aCtx, analyzer, data, source, loops = [];

    function startAudio() {
      if (aCtx) { if(aCtx.state === 'suspended') aCtx.resume(); return; }
      aCtx = new (window.AudioContext || window.webkitAudioContext)();
      analyzer = aCtx.createAnalyser();
      source = aCtx.createMediaElementSource(v);
      source.connect(analyzer);
      analyzer.connect(aCtx.destination);
      analyzer.fftSize = 64;
      data = new Uint8Array(analyzer.frequencyBinCount);
      tick();
    }

    function tick() {
      requestAnimationFrame(tick);
      if(!analyzer) return;
      analyzer.getByteFrequencyData(data);
      const avg = data.reduce((a,b) => a+b) / data.length;
      document.documentElement.style.setProperty('--bass', avg / 255);
    }

    function setFX(id) {
      loops.forEach(clearInterval);
      loops = [];
      layers.forEach(l => { l.style.display = 'none'; l.innerHTML = ''; });
      if(!id) return;
      const el = document.getElementById(id);
      el.style.display = 'block';

      const spawn = (html, delay) => {
        loops.push(setInterval(() => {
          const div = document.createElement('div');
          div.innerHTML = html;
          const child = div.firstChild;
          child.style.left = Math.random() * 100 + 'vw';
          el.appendChild(child);
          setTimeout(() => child.remove(), 5000);
        }, delay));
      };

      if(id === 'sakura') spawn('<div class="petal">ðŸŒ¸</div>', 300);
      if(id === 'rain') spawn('<div class="rain-trail"></div>', 60);
      if(id === 'void') spawn('<div class="void-ring"></div>', 600);
      if(id === 'stars') spawn('<div class="dust" style="width:6px;height:6px;"></div>', 100);
      if(id === 'sea') spawn('<div class="bubble" style="width:25px;height:25px;bottom:-30px;"></div>', 300);
      if(id === 'binary') spawn(`<div class="bin">${Math.round(Math.random())}</div>`, 120);
      if(id === 'aura') spawn('<div class="flame" style="left:50vw;transform:translateX(-50%);"></div>', 80);
      if(id === 'storm') spawn('<div class="lightning"></div>', 400);
      if(id === 'hex') spawn('<div class="hex" style="width:70px;height:70px;"></div>', 500);
      if(id === 'flies') {
        for(let i=0; i<40; i++) {
          const f = document.createElement('div');
          f.className = 'firefly';
          f.style.left = Math.random()*100+'vw'; f.style.top = Math.random()*100+'vh';
          el.appendChild(f);
        }
      }
    }
  </script>
</body>
</html>
